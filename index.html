<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Places CSV ç³»çµ±å»ºç½®æ•™å­¸</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; }
        .step-content { display: none; }
        .step-content.active { display: block; }
        .code-block { background: #0f172a; color: #e2e8f0; padding: 1.25rem; border-radius: 0.75rem; overflow-x: auto; font-family: 'Fira Code', monospace; font-size: 0.85rem; line-height: 1.6; max-height: 400px; border: 1px solid #334155; }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 min-h-screen">
    <div class="max-w-4xl mx-auto py-12 px-6">
        <header class="text-center mb-12">
            <h1 class="text-4xl font-extrabold text-indigo-700 mb-3">Google Places CSV æŸ¥è©¢ç³»çµ±</h1>
            <div class="inline-block px-4 py-1 bg-indigo-100 text-indigo-700 rounded-full text-sm font-bold mb-4">ç‰ˆæœ¬ 3.0ï¼šæ”¯æ´å¤šé»æœå°‹èˆ‡å»é‡</div>
            <p class="text-slate-500">æŒ‰ç…§ä»¥ä¸‹æ­¥é©Ÿï¼Œå¿«é€Ÿéƒ¨ç½²æ‚¨çš„åœ°åœ–åœ°æ¨™è’é›†å·¥å…·</p>
        </header>

        <div id="intro-section" class="bg-white shadow-2xl rounded-3xl p-10 mb-8 border border-slate-200">
            <h2 class="text-2xl font-bold mb-6 text-slate-800 underline decoration-indigo-300 decoration-4">1. ç³»çµ±æ¼”ç¤ºèˆ‡æˆæœ</h2>
            <div class="grid md:grid-cols-2 gap-8">
                <div class="space-y-4">
                    <p class="font-bold text-indigo-600 italic">ğŸ”— ç³»çµ±ç¤ºç¯„ç¶²å€ï¼š</p>
                    <a href="https://script.google.com/a/macros/gapp.ylsh.ilc.edu.tw/s/AKfycbwR1Ys4NTeBwc-OG2goQyZ3tVuXNcXFTUVlp_qnmpP9RGQVE_OH2MkAAV8XIBjTh5TSOw/exec" target="_blank" class="block p-4 bg-slate-50 border border-indigo-100 rounded-xl text-blue-600 break-all underline text-sm hover:bg-blue-50 transition">é»æ­¤é–‹å•Ÿç¤ºç¯„ç¶²é </a>
                </div>
                <div class="space-y-4">
                    <p class="font-bold text-emerald-600 italic">ğŸ“Š CSV è¼¸å‡ºå…§å®¹ç¯„ä¾‹ï¼š</p>
                    <div class="text-xs bg-slate-900 text-slate-300 p-4 rounded-xl font-mono leading-relaxed shadow-inner">
                        "åç¨±","ç·¯åº¦","ç¶“åº¦","è©•åˆ†","åœ°å€","é¡å‹","ç”¨æˆ¶è©•åˆ†ç¸½æ•¸"<br>
                        "å®œè˜­é«˜ä¸­",24.75,121.74,4.5,"å®œè˜­ç¸£å®œè˜­å¸‚å¾©èˆˆè·¯ä¸‰æ®µ8è™Ÿ","school",150<br>
                        "æ˜Ÿå·´å…‹å®œè˜­åº—",24.75,121.75,4.2,"å®œè˜­ç¸£å®œè˜­å¸‚...","cafe",420
                    </div>
                </div>
            </div>
            <button onclick="startTutorial()" class="mt-10 w-full bg-indigo-600 text-white py-4 rounded-2xl font-bold text-lg hover:bg-indigo-700 transition transform hover:-translate-y-1 shadow-xl">
                é–‹å§‹é€²è¡Œå¯¦éš›å®‰è£ <i class="fa-solid fa-arrow-right ml-2"></i>
            </button>
        </div>

        <div id="tutorial-section" class="hidden">
            <div class="mb-8 bg-slate-200 rounded-full h-3">
                <div id="progress-bar" class="bg-indigo-600 h-3 rounded-full transition-all duration-700" style="width: 20%"></div>
            </div>

            <div id="step-container" class="bg-white shadow-2xl rounded-3xl p-10 mb-8 border border-slate-100">
                
                <div class="step-content active" id="step1">
                    <h3 class="text-2xl font-bold mb-6 flex items-center text-indigo-800"><span class="bg-indigo-600 text-white w-10 h-10 rounded-full inline-flex items-center justify-center mr-4 shadow-lg">1</span> å–å¾— Google Places API Key</h3>
                    <div class="space-y-4 text-slate-600">
                        <p>1. å‰å¾€ <a href="https://console.cloud.google.com/" target="_blank" class="text-indigo-600 underline font-bold">Google Cloud Console</a>ã€‚</p>
                        <p>2. é»é¸ã€Œå•Ÿç”¨ API æœå‹™ã€ï¼Œæœå°‹ä¸¦å•Ÿç”¨ <span class="bg-amber-100 px-2 rounded text-amber-800 font-bold">Places API</span>ã€‚</p>
                        <p>3. åœ¨ã€Œæ†‘è­‰ã€åˆ†é é»é¸ã€Œå»ºç«‹æ†‘è­‰ã€â†’ã€ŒAPI é‡‘é‘°ã€ï¼Œä¸¦å°‡è©²é‡‘é‘°è¤‡è£½å¦¥ç•¶ã€‚</p>
                    </div>
                </div>

                <div class="step-content" id="step2">
                    <h3 class="text-2xl font-bold mb-6 flex items-center text-indigo-800"><span class="bg-indigo-600 text-white w-10 h-10 rounded-full inline-flex items-center justify-center mr-4 shadow-lg">2</span> æŒ‡ä»¤ç¢¼å±¬æ€§è©³ç´°è¨­å®š</h3>
                    <p class="text-slate-600 mb-6 italic leading-relaxed">é€™æ˜¯æœ€é—œéµçš„ä¸€æ­¥ï¼Œè«‹ä¾ç…§ä¸‹åœ–æŒ‡ç¤ºåœ¨ Google Apps Script å°ˆæ¡ˆä¸­å®Œæˆè¨­å®šï¼š</p>
                    
                    <div class="bg-slate-50 border-2 border-dashed border-slate-300 p-6 rounded-2xl space-y-6">
                        <div class="flex items-start space-x-4 text-sm">
                            <div class="flex-1 bg-white p-4 rounded-xl shadow-sm border border-slate-200">
                                <p class="font-bold text-slate-800 mb-2 underline">æ¬„ä½ï¼šå±¬æ€§ (Property)</p>
                                <code class="text-indigo-700 font-bold text-base">GOOGLE_PLACES_API_KEY</code>
                            </div>
                            <div class="flex-1 bg-white p-4 rounded-xl shadow-sm border border-slate-200">
                                <p class="font-bold text-slate-800 mb-2 underline">æ¬„ä½ï¼šå€¼ (Value)</p>
                                <code class="text-slate-400 italic text-sm">è²¼ä¸Šæ‚¨çš„é‡‘é‘°ï¼Œä¾‹å¦‚ï¼š</code><br>
                                <code class="text-emerald-600 font-bold text-xs break-all">AIzaSyA6Xv6T_Example_Key_2024_GAS_V3</code>
                            </div>
                        </div>
                        <div class="bg-indigo-900 text-indigo-100 p-4 rounded-xl text-xs leading-relaxed">
                            <i class="fa-solid fa-circle-info mr-2 text-amber-400"></i> è¨­å®šè·¯å¾‘ï¼šå·¦å´å´é‚Šæ¬„çš„ âš™ï¸ <b>å°ˆæ¡ˆè¨­å®š</b> > æ‹‰åˆ°æœ€ä¸‹æ–¹çš„ <b>æŒ‡ä»¤ç¢¼å±¬æ€§</b> > é»é¸ <b>æ–°å¢æŒ‡ä»¤ç¢¼å±¬æ€§</b>ã€‚
                        </div>
                    </div>
                </div>

                <div class="step-content" id="step3">
                    <h3 class="text-2xl font-bold mb-6 flex items-center text-indigo-800"><span class="bg-indigo-600 text-white w-10 h-10 rounded-full inline-flex items-center justify-center mr-4 shadow-lg">3</span> è²¼ä¸Šå¾Œç«¯ç¨‹å¼ç¢¼ (Code.gs)</h3>
                    <p class="text-slate-600 mb-4 font-medium text-sm">æ­¤ç‰ˆæœ¬æ”¯æ´ã€Œå¤šåº§æ¨™å»é‡ã€èˆ‡ã€Œäº¤é›†/è¯é›†ã€æœå°‹é‚è¼¯ï¼š</p>
                    <div class="relative group">
                        <button onclick="copyCode('code-gs-text')" class="absolute right-4 top-4 bg-indigo-600 text-white px-4 py-2 rounded-lg text-xs font-bold hover:bg-indigo-700 z-10 transition shadow-lg">è¤‡è£½ Code.gs</button>
                        <pre class="code-block shadow-inner" id="code-gs-display"></pre>
                    </div>
                </div>

                <div class="step-content" id="step4">
                    <h3 class="text-2xl font-bold mb-6 flex items-center text-indigo-800"><span class="bg-indigo-600 text-white w-10 h-10 rounded-full inline-flex items-center justify-center mr-4 shadow-lg">4</span> è²¼ä¸Šå‰ç«¯ç¨‹å¼ç¢¼ (Index.html)</h3>
                    <p class="text-slate-600 mb-4 font-medium text-sm">æ›´æ–°å¾Œçš„ä»‹é¢èˆ‡èªªæ˜æ–‡å­—ï¼Œè«‹æ–°å¢ Index.html æª”æ¡ˆä¸¦è²¼å…¥ï¼š</p>
                    <div class="relative group">
                        <button onclick="copyCode('index-html-text')" class="absolute right-4 top-4 bg-emerald-600 text-white px-4 py-2 rounded-lg text-xs font-bold hover:bg-emerald-700 z-10 transition shadow-lg">è¤‡è£½ Index.html</button>
                        <pre class="code-block shadow-inner" id="index-html-display"></pre>
                    </div>
                </div>

                <div class="step-content" id="step5">
                    <h3 class="text-2xl font-bold mb-6 flex items-center text-indigo-800"><span class="bg-indigo-600 text-white w-10 h-10 rounded-full inline-flex items-center justify-center mr-4 shadow-lg">5</span> å®Œæˆéƒ¨ç½² (Web App)</h3>
                    <div class="space-y-4">
                        <p class="text-slate-700 font-bold">é»æ“Šå³ä¸Šè§’ã€Œéƒ¨ç½²ã€ > ã€Œæ–°å¢éƒ¨ç½²ã€ï¼š</p>
                        <ul class="space-y-3">
                            <li class="flex items-center bg-slate-50 p-3 rounded-lg border border-slate-200"><i class="fa-solid fa-check-circle text-indigo-500 mr-3"></i> é¡å‹é¸æ“‡ï¼š<span class="font-bold ml-1">ç¶²é æ‡‰ç”¨ç¨‹å¼</span></li>
                            <li class="flex items-center bg-slate-50 p-3 rounded-lg border border-slate-200"><i class="fa-solid fa-check-circle text-indigo-500 mr-3"></i> åŸ·è¡Œèº«åˆ†ï¼š<span class="font-bold ml-1">æˆ‘</span></li>
                            <li class="flex items-center bg-slate-50 p-3 rounded-lg border border-slate-200"><i class="fa-solid fa-check-circle text-indigo-500 mr-3"></i> èª°æœ‰æ¬Šå­˜å–ï¼š<span class="font-bold ml-1">æ‰€æœ‰äºº / çŸ¥é“é€£çµçš„äºº</span></li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="flex justify-between items-center px-4">
                <button id="prevBtn" onclick="changeStep(-1)" class="bg-slate-200 text-slate-600 px-8 py-3 rounded-2xl font-bold disabled:opacity-0 transition hover:bg-slate-300">ä¸Šä¸€æ­¥</button>
                <div class="text-slate-400 font-mono text-sm">STEP <span id="stepNum">1</span> / 5</div>
                <button id="nextBtn" onclick="changeStep(1)" class="bg-indigo-600 text-white px-8 py-3 rounded-2xl font-bold hover:bg-indigo-700 transition shadow-xl shadow-indigo-200">ä¸‹ä¸€æ­¥</button>
            </div>
        </div>
    </div>

    <textarea id="code-gs-text" class="hidden">
function doGet() {
  return HtmlService.createHtmlOutputFromFile('Index')
    .setTitle('Google Places CSV æŸ¥è©¢ç³»çµ±')
    .addMetaTag('viewport', 'width=device-width, initial-scale=1');
}

function searchPlacesCSV(keyword, coordsArray, radius, city) {
  const apiKey = PropertiesService.getScriptProperties().getProperty('GOOGLE_PLACES_API_KEY');
  if (!apiKey) throw new Error('å°šæœªè¨­å®š GOOGLE_PLACES_API_KEY');

  const baseUrl = 'https://maps.googleapis.com/maps/api/place/textsearch/json';
  const seen = new Set(); // è·¨é»å»é‡æ ¸å¿ƒ
  const rows = [];
  rows.push(['åç¨±', 'ç·¯åº¦', 'ç¶“åº¦', 'è©•åˆ†', 'åœ°å€', 'é¡å‹', 'ç”¨æˆ¶è©•åˆ†ç¸½æ•¸']);

  const fullQuery = city ? city + " " + keyword : keyword;
  const keywordNorm = String(keyword).trim();

  // è™•ç†å¤šå€‹ä¸­å¿ƒé»è¼¸å…¥
  coordsArray.forEach(([lat, lng]) => {
    let pageToken = null;
    let loopCount = 0;

    do {
      let url = `${baseUrl}?query=${encodeURIComponent(fullQuery)}&location=${lat},${lng}&radius=${radius}&language=zh-TW&key=${apiKey}`;
      if (pageToken) {
        url += `&pagetoken=${pageToken}`;
        Utilities.sleep(2000); 
      }

      const response = UrlFetchApp.fetch(url, { muteHttpExceptions: true });
      const json = JSON.parse(response.getContentText());
      if (json.status !== 'OK' && json.status !== 'ZERO_RESULTS') break;

      (json.results || []).forEach(p => {
        const name = p.name || '';
        let isMatch = false;

        // é‚è¼¯åˆ¤æ–·: AND / OR
        if (keywordNorm.includes('&')) {
          const kws = keywordNorm.split('&').map(k => k.trim()).filter(k => k !== "");
          isMatch = kws.every(k => name.includes(k));
        } else if (keywordNorm.includes(',')) {
          const kws = keywordNorm.split(',').map(k => k.trim()).filter(k => k !== "");
          isMatch = kws.some(k => name.includes(k));
        } else {
          isMatch = name.includes(keywordNorm);
        }

        if (isMatch && !seen.has(p.place_id)) {
          seen.add(p.place_id);
          rows.push([
            name,
            p.geometry?.location?.lat ?? '',
            p.geometry?.location?.lng ?? '',
            p.rating ?? '',
            p.formatted_address || '',
            (p.types || []).join('|'),
            p.user_ratings_total ?? ''
          ]);
        }
      });

      pageToken = json.next_page_token;
      loopCount++;
    } while (pageToken && loopCount < 3);
  });

  return rows.map(row => row.map(v => `"${String(v).replace(/"/g, '""')}"`).join(',')).join('\n');
}</textarea>

    <textarea id="index-html-text" class="hidden">
<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Google Places CSV æŸ¥è©¢ç³»çµ±</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap');
    body { font-family: 'Noto Sans TC', sans-serif; }
    .loader { border-top-color: #3498db; animation: spinner 1.5s linear infinite; }
    @keyframes spinner { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
  </style>
</head>
<body class="bg-slate-50 min-h-screen">

  <div class="max-w-5xl mx-auto px-4 py-10">
    <div class="text-center mb-10">
      <h1 class="text-4xl font-extrabold text-indigo-900 mb-3">
        <i class="fa-solid fa-map-marked-alt text-indigo-600 mr-2"></i>Google Places CSV æŸ¥è©¢ç³»çµ±
      </h1>
      <p class="text-slate-500 font-medium">æœå°‹GooleMapåœ°åœ–åœ°æ¨™ã€éæ¿¾æ¢ä»¶ä¸¦å¿«é€Ÿå°å‡ºç¶“ç·¯åº¦åº§æ¨™é»CSVå ±è¡¨</p>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
      
      <div class="lg:col-span-4 space-y-6">
        <div class="bg-white rounded-2xl shadow-sm p-6 border-l-4 border-indigo-500">
          <h2 class="text-lg font-bold mb-4 text-slate-800"><i class="fa-solid fa-keyboard text-indigo-500 mr-2"></i>é—œéµå­—æŒ‡ä»¤èªªæ˜</h2>
          <div class="space-y-4 text-sm text-slate-600">
            <div class="bg-indigo-50 p-3 rounded-lg">
              <p class="font-bold text-indigo-700">äº¤é›† (AND)ï¼šä½¿ç”¨ "&"</p>
              <p class="mt-1 font-mono text-xs">ç¯„ä¾‹ï¼šæ˜Ÿå·´å…‹ & å®œè˜­</p>
              <p class="text-[11px] mt-1 italic text-slate-400">åç¨±éœ€åŒæ™‚ç¬¦åˆæ‰€æœ‰æ¢ä»¶</p>
            </div>
            <div class="bg-emerald-50 p-3 rounded-lg">
              <p class="font-bold text-emerald-700">è¯é›† (OR)ï¼šä½¿ç”¨ ","</p>
              <p class="mt-1 font-mono text-xs">ç¯„ä¾‹ï¼š7-11 , å…¨å®¶</p>
              <p class="text-[11px] mt-1 italic text-slate-400">åç¨±ç¬¦åˆå…¶ä¸­ä¹‹ä¸€å³å¯</p>
            </div>
          </div>
        </div>

        <div class="bg-white rounded-2xl shadow-sm p-6 border-l-4 border-slate-300">
          <h2 class="text-lg font-bold mb-2 text-slate-800"><i class="fa-solid fa-circle-info text-slate-400 mr-2"></i>æº«é¦¨æç¤º</h2>
          <ul class="text-xs text-slate-500 space-y-2 list-disc ml-4">
            <li>åº§æ¨™æ ¼å¼è«‹è¼¸å…¥ã€Œç·¯åº¦, ç¶“åº¦ã€ã€‚</li>
            <li>å¯å…ˆè‡³googleMapï¼Œåœ¨æœå°‹ç¯„åœçš„åœ°åœ–ä¸­å¿ƒæŒ‰ä¸‹å³éµå¯è¤‡è£½åº§æ¨™ã€‚</li>
            <li>æœå°‹åŠå¾‘æœ€å¤§é™åˆ¶ç‚º 50,000 å…¬å°ºã€‚</li>
            <li>è‹¥é¸å¡«ç¸£å¸‚ï¼Œç³»çµ±æœƒè‡ªå‹•åœ¨é—œéµå­—å‰åŠ ä¸Šç¸£å¸‚åä»¥å¢åŠ ç²¾æº–åº¦ã€‚</li>
            <li>é¿å…ç¶²è·¯æ”»æ“Šï¼ŒåŒé›»è…¦æ¯åˆ†é˜åªé™æŸ¥è©¢ä¸€æ¬¡ã€‚</li>
          </ul>
        </div>
      </div>

      <div class="lg:col-span-8">
        <div class="bg-white rounded-2xl shadow-xl p-8 border border-slate-100">
          <form id="searchForm" class="space-y-6">
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
              <div>
                <label class="block text-slate-700 font-bold mb-2 text-sm">æœå°‹ç¸£å¸‚ (é¸å¡«)</label>
                <select id="city" class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-indigo-500 outline-none transition bg-slate-50">
                  <option value="">-- å…¨å°ç£ (ä¸é™) --</option>
                  <option value="è‡ºåŒ—å¸‚">è‡ºåŒ—å¸‚</option><option value="æ–°åŒ—å¸‚">æ–°åŒ—å¸‚</option>
                  <option value="æ¡ƒåœ’å¸‚">æ¡ƒåœ’å¸‚</option><option value="è‡ºä¸­å¸‚">è‡ºä¸­å¸‚</option>
                  <option value="è‡ºå—å¸‚">è‡ºå—å¸‚</option><option value="é«˜é›„å¸‚">é«˜é›„å¸‚</option>
                  <option value="å®œè˜­ç¸£">å®œè˜­ç¸£</option><option value="èŠ±è“®ç¸£">èŠ±è“®ç¸£</option>
                  <option value="è‡ºæ±ç¸£">è‡ºæ±ç¸£</option><option value="æ¾æ¹–ç¸£">æ¾æ¹–ç¸£</option>
                  <option value="é‡‘é–€ç¸£">é‡‘é–€ç¸£</option><option value="é€£æ±Ÿç¸£">é€£æ±Ÿç¸£</option>
                  <option value="åŸºéš†å¸‚">åŸºéš†å¸‚</option><option value="æ–°ç«¹å¸‚">æ–°ç«¹å¸‚</option>
                  <option value="æ–°ç«¹ç¸£">æ–°ç«¹ç¸£</option><option value="è‹—æ —ç¸£">è‹—æ —ç¸£</option>
                  <option value="å½°åŒ–ç¸£">å½°åŒ–ç¸£</option><option value="å—æŠ•ç¸£">å—æŠ•ç¸£</option>
                  <option value="é›²æ—ç¸£">é›²æ—ç¸£</option><option value="å˜‰ç¾©ç¸£">å˜‰ç¾©ç¸£</option>
                  <option value="å˜‰ç¾©å¸‚">å˜‰ç¾©å¸‚</option><option value="å±æ±ç¸£">å±æ±ç¸£</option>
                </select>
              </div>
              <div>
                <label class="block text-slate-700 font-bold mb-2 text-sm">æœå°‹é—œéµå­—</label>
                <input type="text" id="keyword" placeholder="è¼¸å…¥é—œéµå­—..." class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-indigo-500 outline-none transition" required>
              </div>
            </div>

            <div class="space-y-4">
              <label class="block text-slate-700 font-bold text-sm">ä¸­å¿ƒé»åº§æ¨™ (å¯è¼¸å…¥ Aã€Bã€C ä¸‰è™•åº§æ¨™é€²è¡Œä¸€æ¬¡æœå°‹)</label>
              <input type="text" id="coord1" placeholder="ä¸­å¿ƒé» A (ä¾‹å¦‚ï¼š24.75, 121.74)" class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-indigo-500 outline-none transition" required>
              <input type="text" id="coord2" placeholder="ä¸­å¿ƒé» B (é¸å¡«)" class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-indigo-500 outline-none transition">
              <input type="text" id="coord3" placeholder="ä¸­å¿ƒé» C (é¸å¡«)" class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-indigo-500 outline-none transition">
            </div>

            <div>
              <label class="block text-slate-700 font-bold mb-2 text-sm">æœå°‹åŠå¾‘ (å…¬å°º)</label>
              <input type="number" id="radius" value="5000" class="w-full px-4 py-3 rounded-xl border border-slate-200 focus:ring-2 focus:ring-indigo-500 outline-none transition" required>
            </div>

            <button type="submit" id="submitBtn" class="w-full bg-indigo-600 hover:bg-indigo-700 text-white font-bold py-4 rounded-xl shadow-lg shadow-indigo-200 transition-all transform active:scale-[0.98]">
              <i class="fa-solid fa-file-csv mr-2"></i>åŸ·è¡Œå¤šé»æœå°‹ä¸¦åŒ¯å‡º CSV
            </button>
          </form>

          <div id="statusArea" class="mt-8 hidden animate-pulse">
            <div class="flex items-center justify-center p-4 rounded-xl bg-slate-100 border border-slate-200 text-slate-600">
              <div id="spinner" class="loader ease-linear rounded-full border-2 border-t-2 border-slate-300 h-5 w-5 mr-3"></div>
              <span id="message" class="text-sm font-medium">ç³»çµ±æŸ¥è©¢ä¸­ï¼Œè«‹ç¨å€™...</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    document.getElementById('searchForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const city = document.getElementById('city').value;
      const keyword = document.getElementById('keyword').value;
      const radius = document.getElementById('radius').value;
      const submitBtn = document.getElementById('submitBtn');
      const statusArea = document.getElementById('statusArea');
      
      const rawCoords = [
        document.getElementById('coord1').value,
        document.getElementById('coord2').value,
        document.getElementById('coord3').value
      ].filter(v => v.trim() !== "");

      const coordsArray = rawCoords.map(str => {
        const parts = str.split(',');
        return parts.length === 2 ? [parts[0].trim(), parts[1].trim()] : null;
      }).filter(v => v !== null);

      if (coordsArray.length === 0) {
        alert('è«‹è‡³å°‘åœ¨ A æ¬„ä½è¼¸å…¥æ­£ç¢ºçš„åº§æ¨™æ ¼å¼ï¼');
        return;
      }

      submitBtn.disabled = true;
      submitBtn.classList.add('opacity-50');
      statusArea.classList.remove('hidden');

      google.script.run
        .withSuccessHandler(function(csv) {
          const blob = new Blob([new Uint8Array([0xEF, 0xBB, 0xBF]), csv], { type: 'text/csv;charset=utf-8;' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = `GooglePlaces_Multi_${keyword}.csv`;
          a.click();
          URL.revokeObjectURL(url);
          statusArea.classList.add('hidden');
          submitBtn.disabled = false;
          submitBtn.classList.remove('opacity-50');
          alert('ä¸‹è¼‰å®Œæˆï¼');
        })
        .withFailureHandler(function(err) {
          alert('éŒ¯èª¤ï¼š' + err.message);
          submitBtn.disabled = false;
          submitBtn.classList.remove('opacity-50');
          statusArea.classList.add('hidden');
        })
        .searchPlacesCSV(keyword, coordsArray, radius, city);
    });
  </script>
</body>
</html></textarea>

    <script>
        let currentStep = 1;
        const totalSteps = 5;

        // åˆå§‹åŒ–é¡¯ç¤ºåŸå§‹ç¢¼
        document.getElementById('code-gs-display').textContent = document.getElementById('code-gs-text').value.trim();
        document.getElementById('index-html-display').textContent = document.getElementById('index-html-text').value.trim();

        function startTutorial() {
            document.getElementById('intro-section').classList.add('hidden');
            document.getElementById('tutorial-section').classList.remove('hidden');
        }

        function changeStep(delta) {
            document.getElementById(`step${currentStep}`).classList.remove('active');
            currentStep += delta;
            
            if (currentStep > totalSteps) {
                alert('æ•™ç¨‹çµæŸï¼è«‹è¿”å›å°ˆæ¡ˆå®Œæˆéƒ¨ç½²ã€‚');
                location.reload();
                return;
            }

            document.getElementById(`step${currentStep}`).classList.add('active');
            document.getElementById('stepNum').innerText = currentStep;
            document.getElementById('progress-bar').style.width = `${(currentStep / totalSteps) * 100}%`;
            document.getElementById('prevBtn').disabled = currentStep === 1;
            document.getElementById('nextBtn').innerText = currentStep === totalSteps ? 'å®Œæˆå»ºç½®' : 'ä¸‹ä¸€æ­¥';
        }

        function copyCode(id) {
            const text = document.getElementById(id);
            text.select();
            document.execCommand('copy');
            alert('ä»£ç¢¼å·²è¤‡è£½åˆ°å‰ªè²¼ç°¿ï¼');
        }
    </script>
</body>
</html>
